# КОДЕКС проекта Ebot

## Общие правила
- Все ключевые изменения фиксируются в PROJECT_MAP.md, VARIABLES.md и README.md.
- Все команды выполняются под root в /root/Ebot, если не указано иное.
- Все действия оформляются по принципу: одна команда — один шаг.
- Если нужно изменить файл и известно его содержимое — сначала очистка, потом полный вставляемый текст.
- После каждой главы проекта проводится финальная проверка.

## Формат логов и данных
- Все сделки (dry/live) фиксируются в trades.log и в таблицах trades_dry/trades_live.
- В DRY режиме сделки пишутся только в trades_dry, в LIVE — только в trades_live. Любое смешение считается багом.
- Формат trade.log: ts, side, symbol, qty, price, pnl, equity.
- В DRY режиме стартовый баланс берётся из DRY_USDC_START.
- Баланс и PnL всегда указываются в USDC и %.
- Все сигналы стратегии (пересечения EMA) фиксируются в отдельном файле signals.log.
  - Формат: ts_ms, human_ts, symbol, exchange, interval, signal_type, EMA_fast, EMA_slow, gap_bps, decision (OPENED/IGNORED), reason.
  - signals.log создаётся автоматически при первом сигнале.
- Если в течение 24 часов не зафиксировано ни одного сигнала — обязательное уведомление в лог/Telegram.

## Telegram
- Все уведомления (сделки, отчёты) отправляются через notify.py.
- В DRY режиме текст всегда помечается "DRY".
- Формат:  
  SYMBOL/EXCHANGE  
  BUY/SELL: qty  
  PRICE: price  
  BAL: equity USDC (+/-pnl%)  
  -----------------  
  ts (человеческий формат)  
  TOTAL: equity $ / +X%

## Стиль работы
- Все коды и скрипты лежат в подкаталогах: core, strategies, db, services, exch.
- Резервные копии файлов сохраняются в /root/Ebot/backups с датой/временем.
- При изменении структуры БД обязательна миграция и запись в VARIABLES.md.
- DRY и LIVE всегда должны использовать один и тот же код, различие только в конфиге.
- Все фильтры и пороги (например, GAP_THRESHOLD_BPS) должны быть параметризованы в конфиге, а не зашиты в код.

## Приоритеты
1. Запуск DRY (отладка стратегий).
2. Подключение LIVE (минимальными объёмами).
3. Автоматизация отчётов и логирования.
4. Расширение стратегий.
5. Интерфейсы (Telegram/Web).

> Этот файл — обязательная часть документации. При противоречии текстов приоритет имеет КОДЕКС.
